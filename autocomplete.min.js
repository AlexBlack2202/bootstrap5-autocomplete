var f={showAllSuggestions:!1,suggestionsThreshold:1,maximumItems:0,autoselectFirst:!0,updateOnSelect:!1,highlightTyped:!1,fullWidth:!1,fixed:!1,labelField:"label",valueField:"value",queryParam:"query",items:[],source:null,datalist:"",server:"",serverParams:{},liveServer:!1,noCache:!0,debounceTime:300,notFoundMessage:"",onRenderItem:(a,t)=>t,onSelectItem:a=>{},onServerResponse:a=>a.json()},m="is-loading",w="is-active",l=["is-active","bg-primary","text-white"],h="next",p="prev",c=new WeakMap,b=0;function L(a,t=300){let i;return(...e)=>{clearTimeout(i),i=setTimeout(()=>{a.apply(this,e)},t)}}function u(a){return a.normalize("NFD").replace(/[\u0300-\u036f]/g,"")}function A(a,t){return a.parentNode.insertBefore(t,a.nextSibling)}var v=class{constructor(t,i={}){if(!(t instanceof HTMLElement)){console.error("Invalid element",t);return}c.set(t,this),b++,this.s=t,this.p(i),this.l=!1,this.r=!1,this.b=L(()=>{this.d(!0)},this.e.debounceTime),this.v(),this.g(),this.e.fixed&&document.addEventListener("scroll",this),this.s.addEventListener("focus",this),this.s.addEventListener("blur",this),this.s.addEventListener("input",this),this.s.addEventListener("keydown",this),this.i.addEventListener("mousemove",this),this.w()}static init(t="input.autocomplete",i={}){document.querySelectorAll(t).forEach(s=>{this.getOrCreateInstance(s,i)})}static getInstance(t){return c.has(t)?c.get(t):null}static getOrCreateInstance(t,i={}){return this.getInstance(t)||new this(t,i)}dispose(){this.s.removeEventListener("focus",this),this.s.removeEventListener("blur",this),this.s.removeEventListener("input",this),this.s.removeEventListener("keydown",this),this.i.removeEventListener("mousemove",this),this.e.fixed&&document.removeEventListener("scroll",this),this.i.parentElement.removeChild(this.i),c.delete(this.s)}handleEvent(t){this[`on${t.type}`](t)}p(t={}){this.e=Object.assign({},f);let i={...t,...this.s.dataset},e=s=>["true","false","1","0",!0,!1].includes(s)&&!!JSON.parse(s);for(let[s,n]of Object.entries(f)){if(i[s]===void 0)continue;let r=i[s];switch(typeof n){case"number":this.e[s]=parseInt(r);break;case"boolean":this.e[s]=e(r);break;case"string":this.e[s]=r.toString();break;case"object":if(Array.isArray(n))if(typeof r=="string"){let o=r.includes("|")?"|":",";this.e[s]=r.split(o)}else this.e[s]=r;else this.e[s]=typeof r=="string"?JSON.parse(r):r;break;case"function":this.e[s]=typeof r=="string"?window[r]:r;break;default:this.e[s]=r;break}}}v(){this.s.autocomplete="off",this.s.spellcheck=!1,this.s.ariaAutoComplete="list",this.s.ariaExpanded="false",this.s.ariaHasPopup="menu",this.s.setAttribute("role","combobox")}g(){this.i=document.createElement("ul"),this.i.setAttribute("id","ac-menu-"+b),this.i.setAttribute("role","menu"),this.i.classList.add("dropdown-menu","autocomplete-menu","p-0"),this.i.style.maxHeight="280px",this.e.fullWidth||(this.i.style.maxWidth="360px"),this.e.fixed&&(this.i.style.position="fixed"),this.i.style.overflowY="auto",A(this.s,this.i),this.s.setAttribute("aria-controls",this.i.getAttribute("id"))}oninput(t){this.l||this.f()}onblur(t){this.n()}onfocus(t){this.f()}onkeydown(t){if(!this.isDropdownVisible())return;switch(t.keyCode||t.key){case 13:case"Enter":t.preventDefault();let e=this.getSelection();e&&e.click();break;case 38:case"ArrowUp":t.preventDefault(),this.r=!0,this.h(p);break;case 40:case"ArrowDown":t.preventDefault(),this.r=!0,this.h(h);break;case 27:case"Escape":this.s.focus(),this.n();break}}onmousemove(t){this.r=!1}onscroll(t){this.m()}getConfig(t=null){return t!==null?this.e[t]:this.e}setConfig(t,i){this.e[t]=i}setData(t){this.a={},this.c(t)}enable(){this.s.setAttribute("disabled","")}disable(){this.s.removeAttribute("disabled")}isDisabled(){return this.s.hasAttribute("disabled")||this.s.disabled||this.s.hasAttribute("readonly")}isDropdownVisible(){return this.i.classList.contains("show")}getSelection(){return this.i.querySelector("a."+w)}removeSelection(){let t=this.getSelection();t&&t.classList.remove(...l)}h(t=h){let i=this.getSelection(),e=null;if(!i)e=this.i.firstChild;else{let s=t===h?"nextSibling":"previousSibling";e=i.parentNode;do e=e[s];while(e&&e.style.display=="none");e?(i.classList.remove(...l),t===p?e.parentNode.scrollTop=e.offsetTop-e.parentNode.offsetTop:e.offsetTop>e.parentNode.offsetHeight-e.offsetHeight&&(e.parentNode.scrollTop+=e.offsetHeight)):i&&(e=i.parentElement)}if(e){let s=e.querySelector("a");s.classList.add(...l),this.s.setAttribute("aria-activedescendant",s.getAttribute("id")),this.e.updateOnSelect&&(this.s.value=s.dataset.label)}else this.s.setAttribute("aria-activedescendant","");return e}L(){return this.isDisabled()?!1:this.s.value.length>=this.e.suggestionsThreshold}f(){if(!this.L()){this.n();return}this.e.liveServer?this.b():this.e.source?this.e.source(this.s.value,t=>{this.setData(t),this.u()}):this.u()}A(t,i){let e=i.label;if(this.e.highlightTyped){let r=u(e).toLowerCase().indexOf(t);e=e.substring(0,r)+`<mark>${e.substring(r,r+t.length)}</mark>`+e.substring(r+t.length,e.length)}e=this.e.onRenderItem(i,e);let s=document.createElement("li");s.setAttribute("role","presentation");let n=document.createElement("a");if(s.append(n),n.setAttribute("id",this.i.getAttribute("id")+"-"+this.i.children.length),n.classList.add("dropdown-item","text-truncate"),n.setAttribute("data-value",i.value),n.setAttribute("data-label",i.label),n.setAttribute("tabindex","-1"),n.setAttribute("role","menuitem"),n.setAttribute("href","#"),n.innerHTML=e,i.data)for(let[r,o]of Object.entries(i.data))n.dataset[r]=o;return n.addEventListener("mouseenter",r=>{this.r||(this.removeSelection(),s.querySelector("a").classList.add(...l))}),n.addEventListener("mousedown",r=>{r.preventDefault()}),n.addEventListener("click",r=>{r.preventDefault(),this.l=!0,this.s.value=i.label,this.e.onSelectItem(i),this.n(),this.l=!1}),s}u(){let t=u(this.s.value).toLowerCase();this.i.innerHTML="";let i=Object.keys(this.a),e=0,s=null;for(let n=0;n<i.length;n++){let r=i[n],o=this.a[r],g=u(o.label).toLowerCase(),y=t.length>0?g.indexOf(t)>=0:!0;if(this.e.showAllSuggestions||y){e++;let d=this.A(t,o);if(s||(s=d),this.i.appendChild(d),this.e.maximumItems>0&&e>=this.e.maximumItems)break}}if(s&&this.e.autoselectFirst&&this.h(h),e===0)if(this.e.notFoundMessage){let n=document.createElement("li");n.setAttribute("role","presentation"),n.innerHTML=`<span class="dropdown-item">${this.e.notFoundMessage}</span>`,this.i.appendChild(n)}else this.n();else this.i.classList.add("show"),this.s.ariaExpanded="true",this.m()}n(){this.i.classList.remove("show"),this.s.ariaExpanded="false",this.removeSelection()}E(){let t=this.s.parentElement;for(;t&&t instanceof HTMLElement;){if(t.style.position==="fixed")return!0;t=t.parentElement}return!1}m(){let t=this.s.getBoundingClientRect(),i=this.E();if(this.e.fullWidth)this.i.style.width=this.s.offsetWidth+"px";else{let e=i?window.innerWidth:document.body.offsetWidth,s=30,n=e-1-(t.x+this.i.offsetWidth)-s;n<0&&(this.i.style.transform="translateX(calc("+n+"px))")}if(this.e.fixed)this.i.style.transform="translateY(calc(-"+window.pageYOffset+"px))";else{let e=i?window.innerHeight:document.body.offsetHeight,s=t.y+window.pageYOffset+this.i.offsetHeight;e-s<0&&e>t.height?this.i.style.transform="translateY(calc(-100% - "+this.s.offsetHeight+"px))":this.i.style.transform="none"}}w(){if(this.a={},this.c(this.e.items),this.e.datalist){let t=document.querySelector(`#${this.e.datalist}`);if(t){let i=Array.from(t.children).map(e=>{let s=e.getAttribute("value")??e.innerHTML.toLowerCase(),n=e.innerHTML;return{value:s,label:n}});this.c(i)}}this.e.server&&!this.e.liveServer&&this.d()}c(t){let i=Object.keys(t);for(let e=0;e<i.length;e++){let s=i[e],n=t[s],r=typeof n=="string"?{}:n;r.label=n[this.e.labelField]??n,r.value=n[this.e.valueField]??s,this.a[r.value]=r}}d(t=!1){this.o&&this.o.abort(),this.o=new AbortController;let i=Object.assign({},this.e.serverParams);if(i[this.e.queryParam]=this.s.value,this.e.noCache&&(i.t=Date.now()),i.related){let s=document.getElementById(i.related);s&&(i.related=s.value)}let e=new URLSearchParams(i).toString();this.s.classList.add(m),fetch(this.e.server+"?"+e,{signal:this.o.signal}).then(s=>this.e.onServerResponse(s)).then(s=>{let n=s.data||s;this.setData(n),this.o=null,t&&this.u()}).catch(s=>{s.name!=="AbortError"&&console.error(s)}).finally(s=>{this.s.classList.remove(m)})}},E=v;export{E as default};
//# sourceMappingURL=autocomplete.min.js.map
