var m={showAllSuggestions:!1,suggestionsThreshold:1,maximumItems:0,autoselectFirst:!0,updateOnSelect:!1,highlightTyped:!1,fullWidth:!1,labelField:"label",valueField:"value",queryParam:"query",items:[],source:null,datalist:"",server:"",serverParams:{},liveServer:!1,noCache:!0,debounceTime:300,notFoundMessage:"",onRenderItem:(a,t)=>t,onSelectItem:a=>{},onServerResponse:a=>a.json()},p="is-loading",w="is-active",h=["is-active","bg-primary","text-white"],c="next",b="prev",u=new WeakMap,v=0;function A(a,t=300){let i;return(...e)=>{clearTimeout(i),i=setTimeout(()=>{a.apply(this,e)},t)}}function d(a){return a.normalize("NFD").replace(/[\u0300-\u036f]/g,"")}function L(a,t){return a.parentNode.insertBefore(t,a.nextSibling)}var g=class{constructor(t,i={}){if(!(t instanceof HTMLElement)){console.error("Invalid element",t);return}u.set(t,this),v++,this.e=t,this.m(i),this.l=!1,this.r=!1,this.p=A(()=>{this.d(!0)},this.s.debounceTime),this.b(),this.v(),this.e.addEventListener("focus",this),this.e.addEventListener("blur",this),this.e.addEventListener("input",this),this.e.addEventListener("keydown",this),this.i.addEventListener("mousemove",this),this.g()}static init(t="input.autocomplete",i={}){document.querySelectorAll(t).forEach(s=>{this.getOrCreateInstance(s,i)})}static getInstance(t){return u.has(t)?u.get(t):null}static getOrCreateInstance(t,i={}){return this.getInstance(t)||new this(t,i)}dispose(){this.e.removeEventListener("focus",this),this.e.removeEventListener("blur",this),this.e.removeEventListener("input",this),this.e.removeEventListener("keydown",this),this.i.removeEventListener("mousemove",this),this.i.parentElement.removeChild(this.i),u.delete(this.e)}handleEvent(t){this[`on${t.type}`](t)}m(t={}){this.s=Object.assign({},m);let i={...t,...this.e.dataset},e=s=>["true","false","1","0",!0,!1].includes(s)&&!!JSON.parse(s);for(let[s,n]of Object.entries(m)){if(i[s]===void 0)continue;let r=i[s];switch(typeof n){case"number":this.s[s]=parseInt(r);break;case"boolean":this.s[s]=e(r);break;case"string":this.s[s]=r.toString();break;case"object":if(Array.isArray(n))if(typeof r=="string"){let o=r.includes("|")?"|":",";this.s[s]=r.split(o)}else this.s[s]=r;else this.s[s]=typeof r=="string"?JSON.parse(r):r;break;case"function":this.s[s]=typeof r=="string"?window[r]:r;break;default:this.s[s]=r;break}}}b(){this.e.autocomplete="off",this.e.spellcheck=!1,this.e.ariaAutoComplete="list",this.e.ariaExpanded="false",this.e.ariaHasPopup="menu",this.e.setAttribute("role","combobox")}v(){this.i=document.createElement("ul"),this.i.setAttribute("id","ac-menu-"+v),this.i.setAttribute("role","menu"),this.i.classList.add("dropdown-menu","autocomplete-menu","p-0"),this.i.style.maxHeight="280px",this.s.fullWidth||(this.i.style.maxWidth="360px"),this.i.style.overflowY="auto",L(this.e,this.i),this.e.setAttribute("aria-controls",this.i.getAttribute("id"))}oninput(t){this.l||this.f()}onblur(t){this.n()}onfocus(t){this.f()}onkeydown(t){switch(t.keyCode||t.key){case 13:case"Enter":t.preventDefault();let e=this.getSelection();e&&e.click();break;case 38:case"ArrowUp":t.preventDefault(),this.r=!0,this.h(b);break;case 40:case"ArrowDown":t.preventDefault(),this.r=!0,this.h(c);break;case 27:case"Escape":this.e.focus(),this.n();break}}onmousemove(t){this.r=!1}getConfig(t=null){return t!==null?this.s[t]:this.s}setConfig(t,i){this.s[t]=i}setData(t){this.a={},this.c(t)}enable(){this.e.setAttribute("disabled","")}disable(){this.e.removeAttribute("disabled")}isDisabled(){return this.e.hasAttribute("disabled")||this.e.disabled||this.e.hasAttribute("readonly")}getSelection(){return this.i.querySelector("a."+w)}removeSelection(){let t=this.getSelection();t&&t.classList.remove(...h)}h(t=c){let i=this.getSelection(),e=null;if(!i)e=this.i.firstChild;else{let s=t===c?"nextSibling":"previousSibling";e=i.parentNode;do e=e[s];while(e&&e.style.display=="none");e?(i.classList.remove(...h),t===b?e.parentNode.scrollTop=e.offsetTop-e.parentNode.offsetTop:e.offsetTop>e.parentNode.offsetHeight-e.offsetHeight&&(e.parentNode.scrollTop+=e.offsetHeight)):i&&(e=i.parentElement)}if(e){let s=e.querySelector("a");s.classList.add(...h),this.e.setAttribute("aria-activedescendant",s.getAttribute("id")),this.s.updateOnSelect&&(this.e.value=s.dataset.label)}else this.e.setAttribute("aria-activedescendant","");return e}w(){return this.isDisabled()?!1:this.e.value.length>=this.s.suggestionsThreshold}f(){if(!this.w()){this.n();return}this.s.liveServer?this.p():this.s.source?this.s.source(this.e.value,t=>{this.setData(t),this.u()}):this.u()}A(t,i){let e=i.label;if(this.s.highlightTyped){let r=d(e).toLowerCase().indexOf(t);e=e.substring(0,r)+`<mark>${e.substring(r,r+t.length)}</mark>`+e.substring(r+t.length,e.length)}e=this.s.onRenderItem(i,e);let s=document.createElement("li");s.setAttribute("role","presentation");let n=document.createElement("a");if(s.append(n),n.setAttribute("id",this.i.getAttribute("id")+"-"+this.i.children.length),n.classList.add("dropdown-item","text-truncate"),n.setAttribute("data-value",i.value),n.setAttribute("data-label",i.label),n.setAttribute("tabindex","-1"),n.setAttribute("role","menuitem"),n.setAttribute("href","#"),n.innerHTML=e,i.data)for(let[r,o]of Object.entries(i.data))n.dataset[r]=o;return n.addEventListener("mouseenter",r=>{this.r||(this.removeSelection(),s.querySelector("a").classList.add(...h))}),n.addEventListener("mousedown",r=>{r.preventDefault()}),n.addEventListener("click",r=>{r.preventDefault(),this.l=!0,this.e.value=i.label,this.s.onSelectItem(i),this.n(),this.l=!1}),s}u(){let t=d(this.e.value).toLowerCase();this.i.innerHTML="";let i=Object.keys(this.a),e=0,s=null;for(let n=0;n<i.length;n++){let r=i[n],o=this.a[r],l=d(o.label).toLowerCase(),y=t.length>0?l.indexOf(t)>=0:!0;if(this.s.showAllSuggestions||y){e++;let f=this.A(t,o);if(s||(s=f),this.i.appendChild(f),this.s.maximumItems>0&&e>=this.s.maximumItems)break}}if(s&&this.s.autoselectFirst&&this.h(c),e===0)if(this.s.notFoundMessage){let n=document.createElement("li");n.setAttribute("role","presentation"),n.innerHTML=`<span class="dropdown-item">${this.s.notFoundMessage}</span>`,this.i.appendChild(n)}else this.n();else this.i.classList.add("show"),this.e.ariaExpanded="true",this.L()}n(){this.i.classList.remove("show"),this.e.ariaExpanded="false",this.removeSelection()}S(){let t=this.e.parentElement;for(;t&&t instanceof HTMLElement;){if(t.style.position==="fixed")return!0;t=t.parentElement}return!1}L(){let t=this.e.getBoundingClientRect(),i=this.S();if(this.s.fullWidth)this.i.style.width=this.e.offsetWidth+"px";else{let r=i?window.innerWidth:document.body.offsetWidth,o=30,l=r-1-(t.x+this.i.offsetWidth)-o;l<0&&(this.i.style.transform="translateX(calc("+l+"px))")}let e=i?window.innerHeight:document.body.offsetHeight,s=t.y+window.pageYOffset+this.i.offsetHeight;e-s<0&&e>t.height?this.i.style.transform="translateY(calc(-100% - "+this.e.offsetHeight+"px))":this.i.style.transform="none"}g(){if(this.a={},this.c(this.s.items),this.s.datalist){let t=document.querySelector(`#${this.s.datalist}`);if(t){let i=Array.from(t.children).map(e=>{let s=e.getAttribute("value")??e.innerHTML.toLowerCase(),n=e.innerHTML;return{value:s,label:n}});this.c(i)}}this.s.server&&!this.s.liveServer&&this.d()}c(t){let i=Object.keys(t);for(let e=0;e<i.length;e++){let s=i[e],n=t[s],r=typeof n=="string"?{}:n;r.label=n[this.s.labelField]??n,r.value=n[this.s.valueField]??s,this.a[r.value]=r}}d(t=!1){this.o&&this.o.abort(),this.o=new AbortController;let i=Object.assign({},this.s.serverParams);if(i[this.s.queryParam]=this.e.value,this.s.noCache&&(i.t=Date.now()),i.related){let s=document.getElementById(i.related);s&&(i.related=s.value)}let e=new URLSearchParams(i).toString();this.e.classList.add(p),fetch(this.s.server+"?"+e,{signal:this.o.signal}).then(s=>this.s.onServerResponse(s)).then(s=>{let n=s.data||s;this.setData(n),this.o=null,t&&this.u()}).catch(s=>{s.name!=="AbortError"&&console.error(s)}).finally(s=>{this.e.classList.remove(p)})}},S=g;export{S as default};
//# sourceMappingURL=autocomplete.min.js.map
