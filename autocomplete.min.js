var m={suggestionsThreshold:2,maximumItems:0,autoselectFirst:!0,highlightTyped:!1,fullWidth:!1,labelField:"label",valueField:"value",items:[],datalist:"",server:"",serverParams:{},liveServer:!1,noCache:!0,debounceTime:300,onRenderItem:(o,e)=>e,onSelectItem:o=>{},onServerResponse:o=>o.json()},v="autocomplete-loading",g="is-active",l=["is-active","bg-primary","text-white"],c="next",p="prev",h=new WeakMap;function y(o,e=300){let s;return(...t)=>{clearTimeout(s),s=setTimeout(()=>{o.apply(this,t)},e)}}function u(o){return o.normalize("NFD").replace(/[\u0300-\u036f]/g,"")}function L(o,e){return o.parentNode.insertBefore(e,o.nextSibling)}var b=class{constructor(e,s={}){h.set(e,this),this.s=e,this.v(s),this.c=!1,this.n=!1,this.r=e.hasAttribute("disabled")||e.hasAttribute("readonly"),this.p=y(()=>{this.u(!0)},this.e.debounceTime),this.b(),this.g(),this.s.addEventListener("focus",this),this.s.addEventListener("blur",this),this.s.addEventListener("input",this),this.s.addEventListener("keydown",this),this.i.addEventListener("mousemove",this),this.L()}static init(e="input.autocomplete",s={}){document.querySelectorAll(e).forEach(t=>{this.getOrCreateInstance(t,s)})}static getInstance(e){return h.has(e)?h.get(e):null}static getOrCreateInstance(e,s={}){return this.getInstance(e)||new this(e,s)}dispose(){this.s.removeEventListener("focus",this),this.s.removeEventListener("blur",this),this.s.removeEventListener("input",this),this.s.removeEventListener("keydown",this),this.i.removeEventListener("mousemove",this),h.delete(this.s)}handleEvent(e){this[`on${e.type}`](e)}v(e={}){this.e=Object.assign({},m);let s={...e,...this.s.dataset},t=i=>["true","false","1","0",!0,!1].includes(i)&&!!JSON.parse(i);for(let[i,n]of Object.entries(m)){let r=s[i];if(s[i]!==void 0)switch(typeof n){case"number":this.e[i]=parseInt(r);break;case"boolean":this.e[i]=t(r);break;case"string":this.e[i]=r.toString();break;case"object":this.e[i]=typeof r=="string"?JSON.parse(r):r;break;default:this.e[i]=r;break}}}b(){this.s.autocomplete="off",this.s.spellcheck=!1}g(){this.i=document.createElement("ul"),this.i.classList.add("dropdown-menu","autocomplete-menu","p-0"),this.i.style.maxHeight="280px",this.e.fullWidth||(this.i.style.maxWidth="360px"),this.i.style.overflowY="auto",L(this.s,this.i)}oninput(e){this.c||this.f()}onblur(e){this.o()}onfocus(e){this.s.value.length===0&&this.e.suggestionsThreshold===0&&this.f()}onmousemove(e){this.n=!1}onkeydown(e){switch(e.keyCode||e.key){case 13:case"Enter":e.preventDefault();let t=this.getSelection();t&&t.click();break;case 38:case"ArrowUp":e.preventDefault(),this.n=!0,this.d(p);break;case 40:case"ArrowDown":e.preventDefault(),this.n=!0,this.getSelection()?this.d(c):this.i.querySelector("a")?.focus();break;case 27:case"Escape":this.s.focus(),this.o();break}}getConfig(e=null){return e!==null?this.e[e]:this.e}setConfig(e,s){this.e[e]=s}setData(e){this.a={},this.l(e)}enable(){this.r=!1}disable(){this.r=!0}isDisabled(){return this.r}getSelection(){return this.i.querySelector("a."+g)}removeSelection(){let e=this.getSelection();e&&e.classList.remove(...l)}d(e=c){let s=this.getSelection(),t=null;if(!s)return t;let i=e===c?"nextSibling":"previousSibling";t=s.parentNode;do t=t[i];while(t&&t.style.display=="none");return t&&(s.classList.remove(...l),t.querySelector("a").classList.add(...l),e===p?t.parentNode.scrollTop=t.offsetTop-t.parentNode.offsetTop:t.offsetTop>t.parentNode.offsetHeight-t.offsetHeight&&(t.parentNode.scrollTop+=t.offsetHeight),t)}S(){return this.r?!1:this.s.value.length>=this.e.suggestionsThreshold}f(){if(!this.S()){this.o();return}this.e.liveServer?this.p():this.m()}w(e,s){let t=s.label;if(this.e.highlightTyped){let r=u(t).toLowerCase().indexOf(e);t=t.substring(0,r)+`<mark>${t.substring(r,r+e.length)}</mark>`+t.substring(r+e.length,t.length)}t=this.e.onRenderItem(s,t);let i=document.createElement("li"),n=document.createElement("a");if(i.append(n),n.classList.add("dropdown-item","text-truncate"),n.setAttribute("data-value",s.value),n.setAttribute("tabindex","-1"),n.setAttribute("href","#"),n.innerHTML=t,s.data)for(let[r,a]of Object.entries(s.data))n.dataset[r]=a;return n.addEventListener("mouseenter",r=>{this.n||(this.removeSelection(),i.querySelector("a").classList.add(...l))}),n.addEventListener("mousedown",r=>{r.preventDefault()}),n.addEventListener("click",r=>{r.preventDefault(),this.c=!0,this.s.value=s.label,this.e.onSelectItem(s),this.o(),this.c=!1}),i}m(){let e=u(this.s.value).toLowerCase(),s=this.i;s.innerHTML="";let t=Object.keys(this.a),i=0,n=null;for(let r=0;r<t.length;r++){let a=t[r],f=this.a[a];if(u(f.label).toLowerCase().indexOf(e)>=0){i++;let d=this.w(e,f);if(n||(n=d),s.appendChild(d),this.e.maximumItems>0&&i>=this.e.maximumItems)break}}n&&this.e.autoselectFirst&&(n.querySelector("a").classList.add(...l),n.parentNode.scrollTop=n.offsetTop),i===0?this.i.classList.remove("show"):(this.i.classList.add("show"),this.k())}o(){this.i.classList.remove("show")}k(){if(this.e.fullWidth)this.i.style.left=this.s.offsetLeft+"px",this.i.style.width=this.s.offsetWidth+"px";else{let i=this.s.offsetLeft,n=document.body.offsetWidth-1,r=30,a=n-(i+this.i.offsetWidth)-r;a<0&&(i=i+a),this.i.style.left=i+"px"}let e=document.body.offsetHeight,s=this.s.getBoundingClientRect().y+window.pageYOffset+this.i.offsetHeight;e-s<0?this.i.style.transform="translateY(calc(-100% - "+this.s.offsetHeight+"px))":this.i.style.transform="none"}L(){if(this.a={},this.l(this.e.items),this.e.datalist){let e=document.querySelector(`#${this.e.datalist}`);if(e){let s=Array.from(e.children).map(t=>{let i=t.getAttribute("value")??t.innerHTML.toLowerCase(),n=t.innerHTML;return{value:i,label:n}});this.l(s)}}this.e.server&&!this.e.liveServer&&this.u()}l(e){let s=Object.keys(e);for(let t=0;t<s.length;t++){let i=s[t],n=e[i],r=typeof n=="string"?{}:n;r.label=n[this.e.labelField]??n,r.value=n[this.e.valueField]??i,this.a[r.value]=r}}u(e=!1){this.h&&this.h.abort(),this.h=new AbortController;let s=Object.assign({},this.e.serverParams);if(s.query=this.s.value,this.e.noCache&&(s.t=Date.now()),s.related){let i=document.getElementById(s.related);i&&(s.related=i.value)}let t=new URLSearchParams(s).toString();this.s.classList.add(v),fetch(this.e.server+"?"+t,{signal:this.h.signal}).then(i=>this.e.onServerResponse(i)).then(i=>{let n=i.data||i;this.l(n),this.h=null,e&&this.m()}).catch(i=>{i.name!=="AbortError"&&console.error(i)}).finally(i=>{this.s.classList.remove(v)})}},S=b;export{S as default};
//# sourceMappingURL=autocomplete.min.js.map
