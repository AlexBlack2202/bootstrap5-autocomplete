var f={suggestionsThreshold:1,maximumItems:0,autoselectFirst:!0,highlightTyped:!1,fullWidth:!1,labelField:"label",valueField:"value",items:[],source:null,datalist:"",server:"",serverParams:{},liveServer:!1,noCache:!0,debounceTime:300,notFoundMessage:"",onRenderItem:(a,t)=>t,onSelectItem:a=>{},onServerResponse:a=>a.json()},m="autocomplete-loading",v="is-active",h=["is-active","bg-primary","text-white"],l="next",p="prev",c=new WeakMap;function g(a,t=300){let i;return(...e)=>{clearTimeout(i),i=setTimeout(()=>{a.apply(this,e)},t)}}function y(){return Math.floor(Math.random()*Date.now())}function u(a){return a.normalize("NFD").replace(/[\u0300-\u036f]/g,"")}function L(a,t){return a.parentNode.insertBefore(t,a.nextSibling)}var b=class{constructor(t,i={}){c.set(t,this),this.e=t,this.p(i),this.l=!1,this.n=!1,this.r=t.hasAttribute("disabled")||t.hasAttribute("readonly"),this.b=g(()=>{this.f(!0)},this.s.debounceTime),this.v(),this.g(),this.e.addEventListener("focus",this),this.e.addEventListener("blur",this),this.e.addEventListener("input",this),this.e.addEventListener("keydown",this),this.i.addEventListener("mousemove",this),this.L()}static init(t="input.autocomplete",i={}){document.querySelectorAll(t).forEach(e=>{this.getOrCreateInstance(e,i)})}static getInstance(t){return c.has(t)?c.get(t):null}static getOrCreateInstance(t,i={}){return this.getInstance(t)||new this(t,i)}dispose(){this.e.removeEventListener("focus",this),this.e.removeEventListener("blur",this),this.e.removeEventListener("input",this),this.e.removeEventListener("keydown",this),this.i.removeEventListener("mousemove",this),c.delete(this.e)}handleEvent(t){this[`on${t.type}`](t)}p(t={}){this.s=Object.assign({},f);let i={...t,...this.e.dataset},e=s=>["true","false","1","0",!0,!1].includes(s)&&!!JSON.parse(s);for(let[s,n]of Object.entries(f)){let r=i[s];if(i[s]!==void 0)switch(typeof n){case"number":this.s[s]=parseInt(r);break;case"boolean":this.s[s]=e(r);break;case"string":this.s[s]=r.toString();break;case"object":this.s[s]=typeof r=="string"?JSON.parse(r):r;break;default:this.s[s]=r;break}}}v(){this.e.autocomplete="off",this.e.spellcheck=!1,this.e.ariaAutoComplete="list",this.e.ariaExpanded="false",this.e.ariaHasPopup="menu",this.e.setAttribute("role","combobox")}g(){this.i=document.createElement("ul"),this.i.setAttribute("id","ac-menu-"+y()),this.i.setAttribute("role","menu"),this.i.classList.add("dropdown-menu","autocomplete-menu","p-0"),this.i.style.maxHeight="280px",this.s.fullWidth||(this.i.style.maxWidth="360px"),this.i.style.overflowY="auto",L(this.e,this.i),this.e.setAttribute("aria-controls",this.i.getAttribute("id"))}oninput(t){this.l||this.m()}onblur(t){this.a()}onfocus(t){this.e.value.length===0&&this.s.suggestionsThreshold===0&&this.m()}onmousemove(t){this.n=!1}onkeydown(t){switch(t.keyCode||t.key){case 13:case"Enter":t.preventDefault();let e=this.getSelection();e&&e.click();break;case 38:case"ArrowUp":t.preventDefault(),this.n=!0,this.c(p);break;case 40:case"ArrowDown":t.preventDefault(),this.n=!0,this.c(l);break;case 27:case"Escape":this.e.focus(),this.a();break}}getConfig(t=null){return t!==null?this.s[t]:this.s}setConfig(t,i){this.s[t]=i}setData(t){this.o={},this.u(t)}enable(){this.r=!1}disable(){this.r=!0}isDisabled(){return this.r}getSelection(){return this.i.querySelector("a."+v)}removeSelection(){let t=this.getSelection();t&&t.classList.remove(...h)}c(t=l){let i=this.getSelection(),e=null;if(!i)e=this.i.firstChild;else{let s=t===l?"nextSibling":"previousSibling";e=i.parentNode;do e=e[s];while(e&&e.style.display=="none");e?(i.classList.remove(...h),t===p?e.parentNode.scrollTop=e.offsetTop-e.parentNode.offsetTop:e.offsetTop>e.parentNode.offsetHeight-e.offsetHeight&&(e.parentNode.scrollTop+=e.offsetHeight)):i&&(e=i.parentElement)}if(e){let s=e.querySelector("a");s.classList.add(...h),this.e.setAttribute("aria-activedescendant",s.getAttribute("id"))}else this.e.setAttribute("aria-activedescendant","");return e}w(){return this.r?!1:this.e.value.length>=this.s.suggestionsThreshold}m(){if(!this.w()){this.a();return}this.s.liveServer?this.b():this.s.source?this.s.source(this.e.value,t=>{this.setData(t),this.d()}):this.d()}A(t,i){let e=i.label;if(this.s.highlightTyped){let r=u(e).toLowerCase().indexOf(t);e=e.substring(0,r)+`<mark>${e.substring(r,r+t.length)}</mark>`+e.substring(r+t.length,e.length)}e=this.s.onRenderItem(i,e);let s=document.createElement("li");s.setAttribute("role","presentation");let n=document.createElement("a");if(s.append(n),n.setAttribute("id",this.i.getAttribute("id")+"-"+this.i.children.length),n.classList.add("dropdown-item","text-truncate"),n.setAttribute("data-value",i.value),n.setAttribute("tabindex","-1"),n.setAttribute("role","menuitem"),n.setAttribute("href","#"),n.innerHTML=e,i.data)for(let[r,o]of Object.entries(i.data))n.dataset[r]=o;return n.addEventListener("mouseenter",r=>{this.n||(this.removeSelection(),s.querySelector("a").classList.add(...h))}),n.addEventListener("mousedown",r=>{r.preventDefault()}),n.addEventListener("click",r=>{r.preventDefault(),this.l=!0,this.e.value=i.label,this.s.onSelectItem(i),this.a(),this.l=!1}),s}d(){let t=u(this.e.value).toLowerCase();this.i.innerHTML="";let i=Object.keys(this.o),e=0,s=null;for(let n=0;n<i.length;n++){let r=i[n],o=this.o[r];if(u(o.label).toLowerCase().indexOf(t)>=0){e++;let d=this.A(t,o);if(s||(s=d),this.i.appendChild(d),this.s.maximumItems>0&&e>=this.s.maximumItems)break}}if(s&&this.s.autoselectFirst&&this.c(l),e===0)if(this.s.notFoundMessage){let n=document.createElement("li");n.setAttribute("role","presentation"),n.innerHTML=`<span class="dropdown-item">${this.s.notFoundMessage}</span>`,this.i.appendChild(n)}else this.i.classList.remove("show"),this.e.ariaExpanded="false";else this.i.classList.add("show"),this.e.ariaExpanded="true",this.S()}a(){this.i.classList.remove("show")}S(){if(this.s.fullWidth)this.i.style.left=this.e.offsetLeft+"px",this.i.style.width=this.e.offsetWidth+"px";else{let s=this.e.offsetLeft,n=document.body.offsetWidth-1,r=30,o=n-(s+this.i.offsetWidth)-r;o<0&&(s=s+o),this.i.style.left=s+"px"}let t=document.body.offsetHeight,i=this.e.getBoundingClientRect().y+window.pageYOffset+this.i.offsetHeight;t-i<0?this.i.style.transform="translateY(calc(-100% - "+this.e.offsetHeight+"px))":this.i.style.transform="none"}L(){if(this.o={},this.u(this.s.items),this.s.datalist){let t=document.querySelector(`#${this.s.datalist}`);if(t){let i=Array.from(t.children).map(e=>{let s=e.getAttribute("value")??e.innerHTML.toLowerCase(),n=e.innerHTML;return{value:s,label:n}});this.u(i)}}this.s.server&&!this.s.liveServer&&this.f()}u(t){let i=Object.keys(t);for(let e=0;e<i.length;e++){let s=i[e],n=t[s],r=typeof n=="string"?{}:n;r.label=n[this.s.labelField]??n,r.value=n[this.s.valueField]??s,this.o[r.value]=r}}f(t=!1){this.h&&this.h.abort(),this.h=new AbortController;let i=Object.assign({},this.s.serverParams);if(i.query=this.e.value,this.s.noCache&&(i.t=Date.now()),i.related){let s=document.getElementById(i.related);s&&(i.related=s.value)}let e=new URLSearchParams(i).toString();this.e.classList.add(m),fetch(this.s.server+"?"+e,{signal:this.h.signal}).then(s=>this.s.onServerResponse(s)).then(s=>{let n=s.data||s;this.setData(n),this.h=null,t&&this.d()}).catch(s=>{s.name!=="AbortError"&&console.error(s)}).finally(s=>{this.e.classList.remove(m)})}},w=b;export{w as default};
//# sourceMappingURL=autocomplete.min.js.map
